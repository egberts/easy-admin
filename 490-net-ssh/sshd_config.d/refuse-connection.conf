#
# File: refuse-connection.conf
# Path: /etc/ssh/ (sshd_config) or /etc/ssh/sshd_config.d/
# Title: Immediate connection refusal policy
# Description:
#
#   'RefuseConnection' controls whether sshd immediately closes
#   incoming TCP connections without performing protocol
#   negotiation.
#
#   #
# RefuseConnection â€” internal behavior reference
#
# Purpose:
#
#   Forces sshd to accept and immediately close inbound TCP
#   connections before SSH protocol negotiation completes.
#
#   No key exchange, authentication, banners, or channels are
#   established.
#
# Enforcement model:
#
#   - Parsed into ServerOptions.refuse_connection
#   - Option is propagated to the privileged monitor process
#   - Enforced exclusively within monitor request handling
#
# Decision timing:
#
#   - After user name resolution (getpwnamallow)
#   - Before authentication methods are constructed
#   - Before unprivileged child receives finalized options
#
# Architectural notes:
#
#   - Enforcement occurs only in the monitor
#   - No checks exist in authentication, channel, or dispatch code
#   - Prevents leakage of hostkeys, banners, and auth policy
#
# Client-visible behavior:
#
#   - TCP connection succeeds
#   - SSH session terminates immediately
#   - Client reports protocol or transport failure
#
#   Syntax:
#
#     RefuseConnection yes|no
#
#   When enabled, sshd accepts the TCP connection and then
#   immediately terminates it.
#
# Logging:
#
#   "administratively prohibited connection for <hostname>
#    from <ip> port <port>, user <username>"
#
#
#   Decision to refuse connection occurs:
#     - right after the UNIX getpwnamallow() function call
#     - right before sending active options to unpriv and
#       before creating a valid list of authentication options,
#       auth method list construction, banner emission,
#       key exchange continuation.
#
#
#   Warnings:
#     - Intended for temporary lockdown or administrative use.
#     - Appears to remote clients as a protocol failure.
#
# CLI option: -o RefuseConnection
# Introduced: 9.9
# Obsoleted: none
# Matchable: NO
# Process context: server daemon (sshd)
# Network stage: authentication
# Dispatch: SSH2_MSG_KEX_DH_GEX_REQUEST
# Dispatch: SSH2_MSG_EXT_INFO
# Dispatch: MONITOR_REQ_PWNAM
# Dispatch: MONITOR_ANS_PWNAM
# Control type: access control
# Channel type: n/a
# Channel name type: n/a
# Mode: accept
# Variable: options.refuse_connection
# Source (read): mm_answer_pwnamallow()/monitor_read()/monitor_child()
# Source (read): mm_answer_pwnamallow()/MONITOR_REQ_PWNAM/mm_answer_sign()/MONITOR_REQ_SIGN/mm_request_send()/mm_sshkey_sign()/sshd_hostkey_sign()/monitor_apply_keystate()/privset_postauth()/main()
# Source (read): mm_answer_pwnamallow()/MONITOR_REQ_PWNAM/mm_answer_sign()/MONITOR_REQ_SIGN/mm_request_send()/mm_sshkey_sign()/sshd_hostkey_sign()/key->sign/input_kex_dh_gex_init()/kexgex_server()
# Source (read): mm_answer_pwnamallow()/MONITOR_REQ_PWNAM/mm_answer_sign()/*
# Source (read): SSH2_MSG_EXT_INFO/user_auth2()
# Source (write): process_server_config_line_depth()/main()
#
RefuseConnection no


